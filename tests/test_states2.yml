---
- name: Test state machines2
  hosts: all
  sources: []
  states:
    - state: dev
      rules:
      - name: rule 1
        condition: event.sensu.data.i == 1 and event.datadog.header.k == 2
        action:
            assert_fact:
              ruleset: Test rules4 Prod
              fact:
                j: 1
      - name: rule 2
        condition: event.payload.text == "hello"
        action:
          debug:
        to: production
    - state: production
      rules:
        - name: rule 3
          condition: event.sensu.data.i == 1 and event.datadog.header.k == 2
          action:
            assert_fact:
              ruleset: Test rules4 Prod
              fact:
              j: 1
        - name: rule 4
          condition: event.payload.text == "goodbye"
          to: shutdown
          action:
            debug:
    - state: shutdown
      rules: []
